# Тестовое задание компании Americor на должность «PHP developer»

Дана часть кода из проекта. Решение вашего задания мы нигде не сможем использовать, у нас эта проблема уже решена. Учтите, что проект и объем данных будут расти, количество типов событий и объектов увеличиваться. 150+ типов событий, рост около 2 типов событий в месяц. 30+ объектов.

**Вариант 1. Рефакторинг кода**

1. Импортируйте код в свой git-репозиторий (не делайте fork).
2. В отдельной ветке проведите рефакторинг вывода ленты истории и экспорта данных.
3. Сделайте pull request из ветки в master (вашего репозитория). В описании pull request:
    - Приведите список изменений.
    - Для каждого изменения опишите, для чего было сделано.
4. Пришлите нам ссылку на pull request.

**Вариант 2. Ревью кода**

1. Укажите места в коде которые требуют улучшений (ссылкой на код)
2. Опишите проблему, почему это проблема и как её нужно решить
3. Пришлите нам результаты в PDF файле.

**При рассмотрении решения хотим увидеть:**

1. Понимание ООП.
2. Умение применять паттерны проектирования.
3. Умение разделять код.
4. Понимание Yii 2.
5. Какие проблемы вы считаете первостепенными.
6. Насколько ваш подход будет удобен в поддержке и развитии.
7. Решение проблемы с экспортом в случае больших данных

**Мое решение**
1. Не хватает php-cs-fixer или файла .editor_config, не понятно какое форматирование кода использовать. Предлагаю добавить php-cs-fixer, но не рамках этого задания.
2. Не хватает стат анализ и соотв. анотаций типов. Предлагаю добавить phpstan на 8 уровне, он очень сильно поможет при рефакторинге и поддержке кода. Не рамках этого задания.
3. Не хватает тестов, поэтому процессе рефакторинга сильно тянется. Предлагаю добавить unit и функциональные тесты. Не а рамках этого задания, но я писал код, так, что его будет просто покртыть unit-тестами.
4. Развил идею в трейтом для подгрузки полиморфным отношений между моделями. Этот трейт можно использовать и в других моделях, где есть полиморфные отношения. Для этого надо в конфиге компонента прописать карту отношений, тогда он решит вопросы подгрузки связей и eager-loading
5. Вынес типы событий в нативный Enum php, добавил тайпкаст для атрибута. Тоже самое можно сделать и другими моделями, но не в рамках этого задания.
6. Переписал виджет списка событий, с использованием фабрики, рендореров и примитивных DTO. Это обеспечит поддерживаемость и масштабируемость кода(кейс когда появится много типов и объектов событий истории)
7. Перенес виджет экспорта данных в виджет списка, потому что судя по коду, там должны быть +- одинаковые данные. Кажется, что пользователь хочет получить в файле то, что видит на экране
8. Обновил зависимости и добавил поддержку php 8.2
9. Решить вопрос с долгим экспортом данных очень просто - надо добавить асинхронную обработку в фоне через queue, но для этого довольно сильно дорабатывать фронт, чтобы нельзя было запускать экспорт пока не завершился предыдущий, и чтобы js опрашивал бекенд и после получения готового файла показывал ссылку  на него. Не в рамках этого задания.
